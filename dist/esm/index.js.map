{"version":3,"file":"index.js","sources":["../../src/index.ts"],"sourcesContent":["import {\n    createKeyValueStorageFromCookieStorageAdapter,\n    createUserPoolsTokenProvider,\n    createAWSCredentialsAndIdentityIdProvider,\n    runWithAmplifyServerContext,\n    type AmplifyServer,\n} from \"aws-amplify/adapter-core\";\nimport type { Cookies } from \"@sveltejs/kit\";\nimport type { ResourcesConfig } from \"aws-amplify\";\n\nconst runWithSvelteAmplifyServerContext = async <Result>(\n    cookies: Cookies,\n    amplifyConfig: ResourcesConfig,\n    operation: (\n        contextSpec: AmplifyServer.ContextSpec,\n    ) => Result | Promise<Result>,\n): Promise<Result> => {\n    if (!amplifyConfig.Auth) throw new Error(\"amplifyConfig.Auth is undefined.\");\n\n    const keyValueStorage = createKeyValueStorageFromCookieStorageAdapter({\n        get(name: string) {\n            const value = cookies.get(encodeURIComponent(name));\n            return { name, value };\n        },\n        getAll() {\n            const cookieList = cookies.getAll();\n            cookieList.forEach(\n                (cookie) => (cookie.name = decodeURIComponent(cookie.name)),\n            );\n            return cookieList;\n        },\n        set(name: string, value: string) {\n            cookies.set(encodeURIComponent(name), value, { path: \"/\" });\n        },\n        delete(name: string) {\n            cookies.delete(encodeURIComponent(name), { path: \"/\" });\n        },\n    });\n\n    const tokenProvider = createUserPoolsTokenProvider(\n        amplifyConfig.Auth,\n        keyValueStorage,\n    );\n\n    const credentialsProvider = createAWSCredentialsAndIdentityIdProvider(\n        amplifyConfig.Auth,\n        keyValueStorage,\n    );\n\n    return await runWithAmplifyServerContext(\n        amplifyConfig,\n        {\n            Auth: { tokenProvider, credentialsProvider },\n        },\n        operation,\n    );\n};\n\nexport { runWithSvelteAmplifyServerContext };\n"],"names":[],"mappings":";;AAUM,MAAA,iCAAiC,GAAG,OACtC,OAAgB,EAChB,aAA8B,EAC9B,SAE6B,KACZ;IACjB,IAAI,CAAC,aAAa,CAAC,IAAI;AAAE,QAAA,MAAM,IAAI,KAAK,CAAC,kCAAkC,CAAC,CAAC;IAE7E,MAAM,eAAe,GAAG,6CAA6C,CAAC;AAClE,QAAA,GAAG,CAAC,IAAY,EAAA;YACZ,MAAM,KAAK,GAAG,OAAO,CAAC,GAAG,CAAC,kBAAkB,CAAC,IAAI,CAAC,CAAC,CAAC;AACpD,YAAA,OAAO,EAAE,IAAI,EAAE,KAAK,EAAE,CAAC;SAC1B;QACD,MAAM,GAAA;AACF,YAAA,MAAM,UAAU,GAAG,OAAO,CAAC,MAAM,EAAE,CAAC;YACpC,UAAU,CAAC,OAAO,CACd,CAAC,MAAM,MAAM,MAAM,CAAC,IAAI,GAAG,kBAAkB,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAC9D,CAAC;AACF,YAAA,OAAO,UAAU,CAAC;SACrB;QACD,GAAG,CAAC,IAAY,EAAE,KAAa,EAAA;AAC3B,YAAA,OAAO,CAAC,GAAG,CAAC,kBAAkB,CAAC,IAAI,CAAC,EAAE,KAAK,EAAE,EAAE,IAAI,EAAE,GAAG,EAAE,CAAC,CAAC;SAC/D;AACD,QAAA,MAAM,CAAC,IAAY,EAAA;AACf,YAAA,OAAO,CAAC,MAAM,CAAC,kBAAkB,CAAC,IAAI,CAAC,EAAE,EAAE,IAAI,EAAE,GAAG,EAAE,CAAC,CAAC;SAC3D;AACJ,KAAA,CAAC,CAAC;IAEH,MAAM,aAAa,GAAG,4BAA4B,CAC9C,aAAa,CAAC,IAAI,EAClB,eAAe,CAClB,CAAC;IAEF,MAAM,mBAAmB,GAAG,yCAAyC,CACjE,aAAa,CAAC,IAAI,EAClB,eAAe,CAClB,CAAC;AAEF,IAAA,OAAO,MAAM,2BAA2B,CACpC,aAAa,EACb;AACI,QAAA,IAAI,EAAE,EAAE,aAAa,EAAE,mBAAmB,EAAE;KAC/C,EACD,SAAS,CACZ,CAAC;AACN;;;;"}